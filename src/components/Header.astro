---
// Header component for Astro
import { getI18nData, getSiteData } from '../data';

// Get current locale
const currentLocale = Astro.currentLocale || 'en';
const t = getI18nData(currentLocale);
const siteData = getSiteData();

// Helper function to get localized URL
function getLocalizedUrl(path: string, locale: string): string {
  // With prefixDefaultLocale: true, all locales need prefix
  return `/${locale}${path}`;
}

// Get current path without locale prefix
const currentPath = (() => {
  let path = Astro.url.pathname.replace(/^\/[a-z]{2}(\/|$)/, '/');
  if (path === '') {
    path = '/';
  }
  return path;
})();

// Get alternate language URLs
const enUrl = getLocalizedUrl(currentPath, 'en');
const esUrl = getLocalizedUrl(currentPath, 'es');
---

<header class="border-b border-gray-100 bg-white/80 backdrop-blur sticky top-0 z-40">
  <div class="max-w-7xl mx-auto px-4 md:px-8 py-6 flex items-center justify-between">
    <a href={getLocalizedUrl('/', currentLocale)} class="text-2xl font-bold text-gray-900 tracking-tight hover:text-brand-600 transition-colors duration-200">
      {siteData.author}
    </a>
    <nav class="flex items-center gap-6">
      <div class="hidden md:flex items-center gap-6">
        <a 
          href={getLocalizedUrl('/', currentLocale)} 
          class="text-gray-600 hover:text-gray-900 font-medium transition-colors duration-200"
        >
          {t.header.home}
        </a>
        <a 
          href={getLocalizedUrl('/blog', currentLocale)} 
          class="text-gray-600 hover:text-gray-900 font-medium transition-colors duration-200"
        >
          {t.header.blog}
        </a>
        <a 
          href={getLocalizedUrl('/certifications', currentLocale)} 
          class="text-gray-600 hover:text-gray-900 font-medium transition-colors duration-200"
        >
          {t.certifications.heading}
        </a>
      </div>
      
      <a 
        href={siteData.calendlyUrl} 
        class="inline-flex items-center rounded-lg bg-brand-600 text-white px-4 py-2.5 text-sm font-medium shadow-sm hover:bg-brand-700 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 transition-all duration-200 transform hover:-translate-y-0.5" 
        data-rum-id="schedule_call" 
        onclick="if(window.recordRumEvent){window.recordRumEvent('cta_click', {button: 'schedule_call'});}"
      >
        {t.header.cta}
      </a>
      
             <div class="flex items-center gap-1 text-sm bg-gray-100 rounded-lg p-1">
               <a 
                 href={enUrl}
                 aria-label="Switch to English" 
                 class={`px-3 py-1.5 rounded-md font-medium transition-all duration-300 ease-in-out transform ${
                   currentLocale === 'en' 
                     ? 'bg-white text-brand-700 shadow-sm scale-105' 
                     : 'text-gray-600 hover:text-brand-700 hover:bg-white/50 hover:scale-102'
                 }`}
               >
                 EN
               </a>
               <a 
                 href={esUrl}
                 aria-label="Cambiar a EspaÃ±ol" 
                 class={`px-3 py-1.5 rounded-md font-medium transition-all duration-300 ease-in-out transform ${
                   currentLocale === 'es' 
                     ? 'bg-white text-brand-700 shadow-sm scale-105' 
                     : 'text-gray-600 hover:text-brand-700 hover:bg-white/50 hover:scale-102'
                 }`}
               >
                 ES
               </a>
             </div>
    </nav>
  </div>
</header>
