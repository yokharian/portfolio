---
import Layout from '../../layouts/Layout.astro';
import BlogCard from '../../components/BlogCard.astro';
import JsonLD from '../../components/JsonLD.astro';
import { getCollection } from 'astro:content';
import i18nData from '../../data/i18n.json';
import siteData from '../../data/site.json';
import certificationsData from '../../data/certifications.json';

// Generate static paths for homepage
export async function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'es' } }
  ];
}

// Get current locale
const currentLocale = Astro.currentLocale || 'en';
const t = i18nData[currentLocale];

// Get blog posts for latest posts section
const allPosts = await getCollection('blog');
const latestPosts = allPosts
  .filter(post => {
    // Check if filename ends with current locale
    const filename = post.id;
    const match = filename.match(/^(.+)\.(en|es)\.md$/);
    return match && match[2] === currentLocale;
  })
  .map(post => {
    // Extract the base slug without language suffix
    const filename = post.id;
    const match = filename.match(/^(.+)\.(en|es)\.md$/);
    const baseSlug = match ? match[1] : post.slug;
    
    return {
      ...post,
      slug: baseSlug
    };
  })
  .sort((a, b) => {
    const dateA = a.data.pubDate || a.data.startDate || a.slug;
    const dateB = b.data.pubDate || b.data.startDate || b.slug;
    return new Date(dateB).getTime() - new Date(dateA).getTime();
  })
  .slice(0, 6); // Show 6 posts instead of 5

// Get certifications for current locale
const certifications = certificationsData[currentLocale]?.names ? Object.values(certificationsData[currentLocale].names) : [];

// No longer needed - using blog posts instead

// Format date helper
function formatDate(date: string | Date): string {
  const d = new Date(date);
  return d.toLocaleDateString(currentLocale, { 
    year: 'numeric', 
    month: '2-digit', 
    day: '2-digit' 
  });
}
---

<Layout 
  title={siteData.title}
  description={siteData.description}
  lang={currentLocale}
>
  <slot name="head">
    <link rel="preload" as="image" href="/assets/images/183728692.jpg">
    <JsonLD type="Person" data={{
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Sofia Escobedo",
      "url": "https://sofiaescobedo.com",
      "jobTitle": "Python & AWS Developer",
      "description": "Python and AWS solutions architect specializing in data-intensive systems in the cloud.",
      "image": "https://sofiaescobedo.com/assets/images/183728692.jpg",
      "sameAs": [
        "https://github.com/sofia-escobedo",
        "https://linkedin.com/in/sofia-escobedo"
      ],
      "knowsAbout": [
        "Python",
        "AWS",
        "Cloud Architecture",
        "Data Engineering",
        "Machine Learning",
        "DevOps"
      ],
      "hasOccupation": {
        "@type": "Occupation",
        "name": "Python & AWS Developer",
        "description": "Design, build, and scale data-intensive systems in the cloud"
      }
    }} />
    <JsonLD type="WebSite" data={{
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Sofia Escobedo - Portfolio",
      "url": "https://sofiaescobedo.com",
      "description": "Portfolio of Sofia Escobedo: Python and AWS solutions architect.",
      "author": {
        "@type": "Person",
        "name": "Sofia Escobedo"
      },
      "inLanguage": ["en", "es"],
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://sofiaescobedo.com/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }} />
  </slot>

  <section id="hero" class="py-24 bg-white/90 backdrop-blur-sm" aria-labelledby="hero-title">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
        <div class="space-y-8" data-anim="hero">
          <h1 id="hero-title" class="text-5xl md:text-6xl lg:text-7xl font-bold text-gray-900 leading-tight" data-i18n-key="hero.title">
            {t.hero.title.split(' ').slice(0, -1).join(' ')} 
            <span class="text-brand-600 italic">{t.hero.title.split(' ').slice(-1)}</span>
          </h1>
          <p class="text-xl md:text-2xl text-gray-600 leading-relaxed max-w-2xl" data-anim="subheading" data-i18n-key="hero.subtitle">
            {t.hero.subtitle}
          </p>
          <div class="mt-8" data-anim="cta">
            <a href={`/${currentLocale}/#blog`} class="inline-flex items-center rounded-lg bg-brand-600 px-8 py-4 text-lg font-semibold text-white shadow-lg hover:bg-brand-700 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 transition-all duration-300 transform hover:-translate-y-1" data-i18n-key="hero.cta">
              {t.hero.cta}
              <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
            </a>
          </div>
        </div>
        <div class="relative" data-anim="profile">
          <div class="w-96 h-96 mx-auto lg:mx-0 relative">
            <div class="absolute inset-0 bg-gradient-to-br from-brand-100 to-brand-200 rounded-full transform rotate-3"></div>
            <img 
              src="/assets/images/183728692.jpg" 
              alt="Professional profile photo of Sofia" 
              class="relative w-full h-full rounded-full object-cover shadow-2xl border-4 border-white"
            />
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="blog" class="py-20 bg-white/95 backdrop-blur-sm" aria-labelledby="blog-title">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 id="blog-title" class="text-4xl md:text-5xl font-bold text-gray-900 mb-4" data-i18n-key="home.featured.heading">
          {t.home.featured.heading}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          {currentLocale === 'en' 
            ? 'Explore my latest insights on Python, AWS, and cloud architecture through detailed technical articles and case studies.'
            : 'Explora mis últimas perspectivas sobre Python, AWS y arquitectura en la nube a través de artículos técnicos detallados y estudios de caso.'
          }
        </p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" role="list">
        {latestPosts.map((post) => (
          <BlogCard post={post} currentLocale={currentLocale} />
        ))}
      </div>
      <div class="mt-12 text-center">
        <a href={`/${currentLocale}/blog/`} class="inline-flex items-center rounded-lg bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 font-semibold transition-all duration-300 transform hover:-translate-y-1" data-i18n-key="home.featured.viewAll">
          {t.home.featured.viewAll}
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <section id="certifications" class="py-20 bg-gray-50/90 backdrop-blur-sm" aria-labelledby="certifications-title">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 id="certifications-title" class="text-4xl md:text-5xl font-bold text-gray-900 mb-4" data-i18n-key="certifications.heading">
          {t.certifications.heading}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          {currentLocale === 'en' 
            ? 'Professional certifications that validate my expertise in cloud technologies and software development.'
            : 'Certificaciones profesionales que validan mi experiencia en tecnologías de nube y desarrollo de software.'
          }
        </p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" role="list">
        {certifications.map((cert: any) => (
          <article class="relative rounded-2xl border border-gray-200 bg-white p-8 shadow-lg transition-all duration-300 hover:shadow-xl focus-within:shadow-xl hover:-translate-y-2 focus-within:-translate-y-2 group" role="listitem">
            <a href={cert.credentialUrl} target="_blank" rel="noopener noreferrer" class="absolute inset-0 rounded-2xl focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 focus-visible:ring-offset-white" aria-label={`${t.certifications.viewCredential}: ${cert.name}`}>
              <span class="sr-only">{t.certifications.viewCredential}: {cert.name}</span>
            </a>
            <div class="flex flex-col items-center text-center space-y-4">
              <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center group-hover:bg-brand-50 transition-colors duration-300">
                <img src={cert.imageUrl} alt={cert.name} width="96" height="96" loading="lazy" decoding="async" class="w-16 h-16 object-contain"/>
              </div>
              <div class="space-y-2">
                <h3 class="text-lg font-bold text-gray-900 group-hover:text-brand-700 transition-colors duration-300">{cert.name}</h3>
                <p class="text-sm text-gray-600">
                  <span class="sr-only">{t.certifications.issuerLabel}: </span>{cert.issuer}
                </p>
                <p class="text-xs text-gray-500">
                  {t.certifications.issuedOn} {formatDate(cert.issuedOn)}
                </p>
              </div>
            </div>
          </article>
        ))}
      </div>

      <script type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "ItemList",
        "itemListElement": certifications.map((cert: any) => ({
          "@type": "EducationalOccupationalCredential",
          "name": cert.name,
          "url": cert.credentialUrl,
          "issuer": {"@type": "Organization", "name": cert.issuer},
          "datePublished": cert.issuedOn
        }))
      })}></script>
    </div>
  </section>

  <section id="experience" class="py-20 bg-white/95 backdrop-blur-sm" aria-labelledby="experience-title">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 id="experience-title" class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
          {currentLocale === 'en' ? 'Technical Expertise' : 'Experiencia Técnica'}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          {currentLocale === 'en' 
            ? 'Core technologies and frameworks I work with to build scalable cloud solutions.'
            : 'Tecnologías principales y frameworks con los que trabajo para construir soluciones escalables en la nube.'
          }
        </p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-8 text-center group hover:shadow-lg transition-all duration-300">
          <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Python & AWS</h3>
          <p class="text-gray-600 mb-4">
            {currentLocale === 'en' 
              ? 'Serverless architectures, data pipelines, and cloud-native applications.'
              : 'Arquitecturas serverless, pipelines de datos y aplicaciones nativas de la nube.'
            }
          </p>
          <div class="flex flex-wrap justify-center gap-2">
            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">Python</span>
            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">AWS Lambda</span>
            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">API Gateway</span>
          </div>
        </div>
        
        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-8 text-center group hover:shadow-lg transition-all duration-300">
          <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Data Engineering</h3>
          <p class="text-gray-600 mb-4">
            {currentLocale === 'en' 
              ? 'ETL processes, data warehousing, and real-time analytics solutions.'
              : 'Procesos ETL, data warehousing y soluciones de análisis en tiempo real.'
            }
          </p>
          <div class="flex flex-wrap justify-center gap-2">
            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">Apache Airflow</span>
            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">DynamoDB</span>
            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">S3</span>
          </div>
        </div>
        
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-8 text-center group hover:shadow-lg transition-all duration-300">
          <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">DevOps & CI/CD</h3>
          <p class="text-gray-600 mb-4">
            {currentLocale === 'en' 
              ? 'Automated deployments, infrastructure as code, and monitoring solutions.'
              : 'Despliegues automatizados, infraestructura como código y soluciones de monitoreo.'
            }
          </p>
          <div class="flex flex-wrap justify-center gap-2">
            <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">Docker</span>
            <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">GitHub Actions</span>
            <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">CloudFormation</span>
          </div>
        </div>
      </div>
    </div>
  </section>

</Layout>
