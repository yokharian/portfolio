---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { getSiteData, getI18nData, getCertificationsData } from '../data';
import { formatReadableDate, formatDateRange, getRelativeTime } from '../utils/date';

// Get blog collection
const allBlogPosts = await getCollection('blog');
const englishPosts = allBlogPosts.filter(post => post.data.lang === 'en');
const spanishPosts = allBlogPosts.filter(post => post.data.lang === 'es');

// Get data
const siteData = getSiteData();
const i18nData = getI18nData('en');
const certificationsData = getCertificationsData('en');

// Test date formatting
const testDate = new Date('2023-06-15');
const testDateFormatted = formatReadableDate(testDate, 'en');
const testDateRange = formatDateRange('2023-01-01', '2023-12-31', 'en');
const testRelativeTime = getRelativeTime('2023-06-15', 'en');
---

<Layout title="Migration Test" description="Testing data and collection migration">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold text-blue-600 mb-8">Migration Test Page</h1>
    
    <!-- Site Data Test -->
    <section class="mb-8 p-6 bg-green-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4 text-green-800">âœ… Site Data Test</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-semibold">Site Information:</h3>
          <ul class="list-disc list-inside text-sm">
            <li><strong>Title:</strong> {siteData.title}</li>
            <li><strong>Description:</strong> {siteData.description}</li>
            <li><strong>Author:</strong> {siteData.author}</li>
            <li><strong>Email:</strong> {siteData.email}</li>
            <li><strong>URL:</strong> {siteData.url}</li>
          </ul>
        </div>
        <div>
          <h3 class="font-semibold">Social Links:</h3>
          <ul class="list-disc list-inside text-sm">
            <li><strong>GitHub:</strong> {siteData.githubUrl}</li>
            <li><strong>LinkedIn:</strong> {siteData.linkedinUrl}</li>
            <li><strong>Calendly:</strong> {siteData.calendlyUrl}</li>
            <li><strong>Twitter:</strong> @{siteData.twitterHandle}</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Content Collections Test -->
    <section class="mb-8 p-6 bg-blue-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4 text-blue-800">âœ… Content Collections Test</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold mb-2">English Posts ({englishPosts.length}):</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            {englishPosts.slice(0, 5).map(post => (
              <li key={post.id}>
                <strong>{post.data.title}</strong>
                {post.data.employer && ` - ${post.data.employer}`}
                {post.data.tags && post.data.tags.length > 0 && (
                  <span class="text-gray-600"> ({post.data.tags.length} tags)</span>
                )}
              </li>
            ))}
            {englishPosts.length > 5 && (
              <li class="text-gray-500">... and {englishPosts.length - 5} more</li>
            )}
          </ul>
        </div>
        <div>
          <h3 class="font-semibold mb-2">Spanish Posts ({spanishPosts.length}):</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            {spanishPosts.slice(0, 5).map(post => (
              <li key={post.id}>
                <strong>{post.data.title}</strong>
                {post.data.employer && ` - ${post.data.employer}`}
                {post.data.tags && post.data.tags.length > 0 && (
                  <span class="text-gray-600"> ({post.data.tags.length} tags)</span>
                )}
              </li>
            ))}
            {spanishPosts.length > 5 && (
              <li class="text-gray-500">... and {spanishPosts.length - 5} more</li>
            )}
          </ul>
        </div>
      </div>
    </section>

    <!-- Date Utilities Test -->
    <section class="mb-8 p-6 bg-purple-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4 text-purple-800">âœ… Date Utilities Test</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-semibold mb-2">Date Formatting:</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><strong>Test Date:</strong> {testDateFormatted}</li>
            <li><strong>Date Range:</strong> {testDateRange}</li>
            <li><strong>Relative Time:</strong> {testRelativeTime}</li>
          </ul>
        </div>
        <div>
          <h3 class="font-semibold mb-2">Spanish Formatting:</h3>
          <ul class="list-disc list-inside text-sm space-y-1">
            <li><strong>Test Date:</strong> {formatReadableDate(testDate, 'es')}</li>
            <li><strong>Date Range:</strong> {formatDateRange('2023-01-01', '2023-12-31', 'es')}</li>
            <li><strong>Relative Time:</strong> {getRelativeTime('2023-06-15', 'es')}</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- i18n Data Test -->
    <section class="mb-8 p-6 bg-yellow-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4 text-yellow-800">âœ… i18n Data Test</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-semibold mb-2">English i18n:</h3>
          <pre class="text-xs bg-white p-2 rounded border overflow-x-auto">
{JSON.stringify(i18nData, null, 2).substring(0, 200)}...
          </pre>
        </div>
        <div>
          <h3 class="font-semibold mb-2">Certifications Data:</h3>
          <pre class="text-xs bg-white p-2 rounded border overflow-x-auto">
{JSON.stringify(certificationsData, null, 2).substring(0, 200)}...
          </pre>
        </div>
      </div>
    </section>

    <!-- Summary -->
    <section class="p-6 bg-gray-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4 text-gray-800">ðŸ“Š Migration Summary</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div class="bg-white p-4 rounded border">
          <div class="text-2xl font-bold text-green-600">{allBlogPosts.length}</div>
          <div class="text-sm text-gray-600">Total Posts</div>
        </div>
        <div class="bg-white p-4 rounded border">
          <div class="text-2xl font-bold text-blue-600">{englishPosts.length}</div>
          <div class="text-sm text-gray-600">English Posts</div>
        </div>
        <div class="bg-white p-4 rounded border">
          <div class="text-2xl font-bold text-red-600">{spanishPosts.length}</div>
          <div class="text-sm text-gray-600">Spanish Posts</div>
        </div>
        <div class="bg-white p-4 rounded border">
          <div class="text-2xl font-bold text-purple-600">âœ…</div>
          <div class="text-sm text-gray-600">Migration Status</div>
        </div>
      </div>
    </section>
  </div>
</Layout>
